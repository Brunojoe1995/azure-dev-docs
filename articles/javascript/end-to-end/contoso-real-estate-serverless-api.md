---
title: "Contoso Real Estate serverless APIs"
description: In this tutorial, developer serverless APIs for Contoso Real Estate using npm workspaces, Azure Functions, OpenAPI and TypeScript.
ms.topic: tutorial
ms.date: 09/18/2023
ms.custom: devx-track-js, devx-track-ts, contoso-real-estate
# CustomerIntent: As a senior developer new to Azure, I want to develop a API layer with modern tools so that I can build scalable and efficient APIs that can handle high traffic loads and integrate with other Azure services seamlessly.
---

# Contoso Real Estate serverless APIs 

The Contoso Real Estate API is a serverless API layer for the enterprise application. The API layer provides access to the data sources including the Strapi headless CMS and the employee reservations and payments. 

## Monorepo design

This reference architecture uses a monorepo to manage the source code for the Contoso Real Estate application. The monorepo is designed with npm workspaces and contains the [API](https://github.com/Azure-Samples/contoso-real-estate/tree/main/packages/api) package.

## API layer

The API layer is the gateway through which the client applications (Blog and Portal) connect to the serverless backend. The API layer is built with Azure Functions and TypeScript and provisioned and deployed with Azure Developer CLI.

* Source code: The API layer is found within the monorepo at the `./packages/api` directory.
* Local development: You can run the Azure Functions app with the npm script `start:api` found in the root [package.json](https://github.com/Azure-Samples/contoso-real-estate/blob/main/package.json) file.
* [Sample real estate listings](https://github.com/Azure-Samples/contoso-real-estate/blob/main/packages/api/data/template/listings.json) 

## API design

The Contoso Real Estate REST API is designed with [TypeSpec](https://microsoft.github.io/typespec/). **TypeSpec** is a language for describing cloud service APIs and generating other API description languages, client and service code, documentation, and other assets. TypeSpec provides highly extensible core language primitives that can describe API shapes common among REST, GraphQL, gRPC, and other protocols. TypeSpec allows you to define the API with TypeScript and generate the OpenAPI specification. 

### Create OpenAPI specification from TypeSpect

1. Install the [TypeSpec CLI](https://www.npmjs.com/package/@typespec/compiler) with npm.

    ```bash
    npm install -g typespec
    ```
2. Create a new project with the `init` command.

    ```bash
    tsp init
    ```

    The `main.tsp` file is created for you.

3. Edit the TypeSpec file with your API definition. The following is an example of the `/api/listings` API endpoint defined with TypeSpec.
    
    ```typescript
    import "@typespec/rest";
    import "@typespec/openapi3";
    
    using TypeSpec.Http;
    
    @service({
      title: "Contoso Real Estate Listings Service",
      version: "2023-09-06",
    })
    @server("/api", "Contoso Azure Hosted Production Endpoint")
    @server("http://localhost:7071/api", "Localhost Development Endpoint")
    @doc("This is the Contoso Real Estate portal listings service")
    namespace ContosoRealEstate;
    
    enum ammenities {
      `swimming pool`,
      gym,
      `wi-fi`,
      parking,
      balcony,
      terrace,
      garden,
      patio,
      sauna,
      jacuzzi,
      fireplace,
      `air conditioning`,
      heating,
      elevator,
      `laundry room`,
      dishwasher,
      microwave,
      furniture,
      `no furniture`,
    }
    
    model Address {
      type: {};
      description: "A valid address for listing";
      id: string;
      slug: string;
      buildingNumber: string;
      street: string;
      city: string;
      zipCode: string;
      country: string;
      createdAt: {
        type: string;
        format: "date-time";
      };
      state?: string;
    }
    
    model Review {
      type: {};
      description: "A valid review for listing";
      id?: string;
      slug?: string;
      userId: string;
      listingId: string;
      rating: int32;
      comment: string;
    }
    
    model Listing {
      @visibility("read")
      id?: {
        type: string;
        format: "uuid";
        description: "Autogenerated unique identifier for the listing";
        example: "1db1f3a89eb2dde64e827aea";
      };
    
      title: string;
      slug: string;
      createdAt?: {
        type: string;
        format: "date-time";
      };
      bathrooms: int32;
      bedrooms: int32;
      description: string;
      type?: string;
      isFeatured?: boolean;
      isRecommended?: boolean;
      photos: string[];
      capacity?: int32;
      ammenities?: {
        type: Array<string>;
        description: "Identifies ammenities in a listing";
        items: {
          type: ContosoRealEstate.ammenities;
          default: [];
          example: ["fireplace", "garden"];
        };
      };
      reviews?: {
        type: Array<string>;
        description: "listing reviews";
        items: {
          $ref: "#/components/schemas/Review";
          example: [
            {
              id: "1db1f3a89eb2dde64e827aea";
              rating: 4;
              comment: "Great place to stay!";
            }
          ];
        };
      };
      address: {
        type: {};
        description: "A valid address for listing";
        $ref: "#/components/schemas/Address";
        example: {
          city: "Edinburgh";
          country: "Scotland";
          street: "Sojourner Drive";
          buildingNumber: "Apt 3B";
          zipCode: "10001";
        };
      };
      fees?: {};
    }
    
    @error
    model Error {
      code: int32;
      message: string;
    }
    
    @route("listings")
    @tag("listing")
    interface Listings {
      @get list(): Listing[] | Error;
      @get read(@path id: string): Listing | Error;
    }
    ``````

4. Generate the OpenAPI specification with the `generate` command.

    ```bash
    tsp compile main.tsp
    ```

5. Review the OpenAPI file:

    ```yaml
    openapi: 3.0.0
    info:
      title: Contoso Real Estate Listings Service
      version: '2023-09-06'
      description: This is the Contoso Real Estate portal listings service
    tags:
      - name: listing
    paths:
      /listings:
        get:
          tags:
            - listing
          operationId: Listings_list
          parameters: []
          responses:
            '200':
              description: The request has succeeded.
              content:
                application/json:
                  schema:
                    type: array
                    items:
                      $ref: '#/components/schemas/Listing'
            default:
              description: An unexpected error response.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Error'
      /listings/{id}:
        get:
          tags:
            - listing
          operationId: Listings_read
          parameters:
            - name: id
              in: path
              required: true
              schema:
                type: string
          responses:
            '200':
              description: The request has succeeded.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Listing'
            default:
              description: An unexpected error response.
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Error'
    components:
      schemas:
        Address:
          type: object
          properties:
            type:
              type: object
              properties: {}
            description:
              type: string
              enum:
                - A valid address for listing
            id:
              type: string
            slug:
              type: string
            buildingNumber:
              type: string
            street:
              type: string
            city:
              type: string
            zipCode:
              type: string
            country:
              type: string
            createdAt:
              type: object
              properties:
                type:
                  type: string
                format:
                  type: string
                  enum:
                    - date-time
              required:
                - type
                - format
            state:
              type: string
          required:
            - type
            - description
            - id
            - slug
            - buildingNumber
            - street
            - city
            - zipCode
            - country
            - createdAt
        Error:
          type: object
          properties:
            code:
              type: integer
              format: int32
            message:
              type: string
          required:
            - code
            - message
        Listing:
          type: object
          properties:
            id:
              type: object
              properties:
                type:
                  type: string
                format:
                  type: string
                  enum:
                    - uuid
                description:
                  type: string
                  enum:
                    - Autogenerated unique identifier for the listing
                example:
                  type: string
                  enum:
                    - 1db1f3a89eb2dde64e827aea
              required:
                - type
                - format
                - description
                - example
              readOnly: true
            title:
              type: string
            slug:
              type: string
            createdAt:
              type: object
              properties:
                type:
                  type: string
                format:
                  type: string
                  enum:
                    - date-time
              required:
                - type
                - format
            bathrooms:
              type: integer
              format: int32
            bedrooms:
              type: integer
              format: int32
            description:
              type: string
            type:
              type: string
            isFeatured:
              type: boolean
            isRecommended:
              type: boolean
            photos:
              type: array
              items:
                type: string
            capacity:
              type: integer
              format: int32
            ammenities:
              type: object
              properties:
                type:
                  type: array
                  items:
                    type: string
                description:
                  type: string
                  enum:
                    - Identifies ammenities in a listing
                items:
                  type: object
                  properties:
                    type:
                      $ref: '#/components/schemas/ammenities'
                    default:
                      type: array
                      items: {}
                    example:
                      type: array
                      items: {}
                  required:
                    - type
                    - default
                    - example
              required:
                - type
                - description
                - items
            reviews:
              type: object
              properties:
                type:
                  type: array
                  items:
                    type: string
                description:
                  type: string
                  enum:
                    - listing reviews
                items:
                  type: object
                  properties:
                    $ref:
                      type: string
                      enum:
                        - '#/components/schemas/Review'
                    example:
                      type: array
                      items: {}
                  required:
                    - $ref
                    - example
              required:
                - type
                - description
                - items
            address:
              type: object
              properties:
                type:
                  type: object
                  properties: {}
                description:
                  type: string
                  enum:
                    - A valid address for listing
                $ref:
                  type: string
                  enum:
                    - '#/components/schemas/Address'
                example:
                  type: object
                  properties:
                    city:
                      type: string
                      enum:
                        - Edinburgh
                    country:
                      type: string
                      enum:
                        - Scotland
                    street:
                      type: string
                      enum:
                        - Sojourner Drive
                    buildingNumber:
                      type: string
                      enum:
                        - Apt 3B
                    zipCode:
                      type: string
                      enum:
                        - '10001'
                  required:
                    - city
                    - country
                    - street
                    - buildingNumber
                    - zipCode
              required:
                - type
                - description
                - $ref
                - example
            fees:
              type: object
              properties: {}
          required:
            - title
            - slug
            - bathrooms
            - bedrooms
            - description
            - photos
            - address
        Review:
          type: object
          properties:
            type:
              type: object
              properties: {}
            description:
              type: string
              enum:
                - A valid review for listing
            id:
              type: string
            slug:
              type: string
            userId:
              type: string
            listingId:
              type: string
            rating:
              type: integer
              format: int32
            comment:
              type: string
          required:
            - type
            - description
            - userId
            - listingId
            - rating
            - comment
        ammenities:
          type: string
          enum:
            - swimming pool
            - gym
            - wi-fi
            - parking
            - balcony
            - terrace
            - garden
            - patio
            - sauna
            - jacuzzi
            - fireplace
            - air conditioning
            - heating
            - elevator
            - laundry room
            - dishwasher
            - microwave
            - furniture
            - no furniture
    servers:
      - url: http://localhost:7071/api
        description: Localhost Development Endpoint
        variables: {}
      - url: /api
        description: Contoso Azure Hosted Production Endpoint
        variables: {}
    ```

## API development

The Azure Functions App allows you to develop the functionality. The Contoso Real Estate API includes the following APIs: 

| API | Method| Description |
| --- | --- | ---|
|`/listings` | GET |Returns a list of listings. |
|`/listings/{listingId}` | GET| Returns a listing by ID. |
|`/users`|GET|Returns a list of Users.|
|`/users`|POST|Create a new user.|
|`/users/{id}`|GET|Get user by ID.|
|`/favorites`|GET|Get all favorites.|
|`/favorites`|POST|Add a favorite.|
|`/favorites`|DELETE|Delete a favorite.|
|`/favorites/{id}`|GET|Returns a favorite by ID.|
|`/reservations`|GET|Get all reservations.|
|`/reservations/{id}`|GET|Get reservation by ID.|
|`/reservations/{id}`|PATCH|Update reservation status.|
|`/checkout`|POST|Checkout a reservation.|
|`/payments`|GET|Get all payments.|
|`/payments`|POST|Add a payment.|
|`/payments/{id}`|GET|Get payment by ID.|

### Environment variables

### Database integration

### Services integration

## Infrastructure development

* azd auth login
* azd provision creates resources and restores database
* azd deploy deploys source code to Azure Functions

## Resource provisioning

The API is contained within an npm workspace and deployed with Azure Developer CLI.

## Source code deployment

* ENABLE_ORYX_BUILD
* SCM_DO_BUILD_DURING_DEPLOYMENT

## API operations
